## Как я парсер писал

# 3.1

Начинаю писать код. Добавляю силениум, суп, тайм (который я позже убрал), и фейк-юзер. Про последний мне рассказали знакомые, после того, как выяснилось, что мой код по какой-то причине обрабатывал 1 запрос в 1,5 минуты (после добавления скорость возрасла до 1 запрос за 0,2 секунды). Вообще, готовый код, который я описываю, работал очень медленно с домашнего интернета, но его скорость на порядки увеличивалась, если я включал VPN. Но с VPN происходили разрывы связи, что обрубало долговременную работу. Так были потеряны примерно 2 дня непрерывной работы. Именно для этого понадобился фейк-юзер, который решил проблему. Также я добавляю специальные опции для ускорения, headless, eager. 

Первой функций я написал scrape(). Передаю ссылку в драйвер, добавляю в return html-версию страницы.

Второй функцией я написал parse(). Запускаем парсер html в супе. В гугле в дополнительных инсрументах разработчика находим html версию страницы, ищем там упоминания количества инцидентов фамилии с Россией. Когда находим, смотрим на расположение в html коде => прописываем путь к инцидентам в России в parse(), в частности находим разделы таблицы table, в ней находим все разделы, внутри идем по ячейкам (если они существуют) и если в них есть Россия достаем содержимое раздела. Извлекаем из раздела количество инцидентов, убираем запятые в str, переводим все в int, возвращаем это int-значение. В случае, если колонки ячейки или России нет, выводим 0.

Третьей функцией я написал insert_data(), из которой пришлось убрать все аргументы. Открываем в датафрейм общий файл, сразу создаем внутри две пустые графы для мужчин и женщин (счет). Идем по индексу и ряду в дф, в случае, если имя имеет не одинаковую форму для мужчины и для женищны, будем учитывать их раздельно. Применяем функцию парсинга к обоим формам, достаем цифру, добавляем их в пустые ячейки созданных графов. Аналогично для случая, где форма одинаковая, только для графы женщин делаем "-". Разумно добавлять информацию по ним единожды, данных о их поле нет. После окончания цикла добавляем дф в финальную таблицу.

# 3.2

Этого не будет.

# 4.

Тривиальный код (часть заимствована из функции вставки). Есть две версии подсчета количества фамилий: сумма и количество тех фамилий, чье наличие в России > 0. Развилка в случае, если форма женской и мужской фамилии совпадает. 

Поиск непопулярных фамилий был посложнее, нужно было сначало объединить графы мужских и женский фамилий, а также их подсчетов. После переформатирования мужских и женских граф я объединил их в одну среду. Далее в общей среде подсчета мне нужно определить топ, значит, нужно избавиться от всех str. Просто так в int перевести нельзя, так как есть ячейки с "-". Для этого перевожу все элементы в графе подсчетов в нумерик, если возникает ошибка -- помечаю как None. После этого дропаю все значения None. Как я понимаю, в топе не должны быть представлены 0, это сделало бы его бессмысленным. Так что и их я тоже дропаю. Итак, все, сортирую по наименьшим 10 в графе счет и вывожу соответствующий счет и фамилии.

Первые этапы работы с гистограммой также предполагают создание двух граф из четырех и в целом идентичны предыдущему решению. Сортирую по возрастаю получившийся счет, а также пропускаю каждые 2/3 фамилий (не очень понял это условие, но тем не менее). Задаю для гистограммы размеры, оси Х и У, размер шрифта для фамилий и их наклон (выглядит все еще не очень ясно). Итак, работа закончена.